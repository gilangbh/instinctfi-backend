# Drift Integration - Setup Summary

## ‚úÖ What's Been Created

Your backend now has **complete Drift Protocol integration** for real trading!

### New Files (5 files)

1. **`src/services/RealDriftService.ts`** - Core Drift trading service
   - Initializes Drift client
   - Opens/closes positions
   - Manages collateral
   - Tracks P/L and positions

2. **`src/services/DriftIntegrationService.ts`** - Mode switcher
   - Switches between mock and real trading
   - Based on `DRIFT_ENABLE_REAL_TRADING` config

3. **`scripts/drift-setup.sh`** - Setup wizard
   - Interactive setup process
   - Generates keypairs
   - Configures environment
   - Funds devnet wallets

4. **`scripts/test-drift.js`** - Connection tester
   - Verifies Drift connection
   - Checks account status
   - Tests oracle prices
   - Initializes user account

5. **`DRIFT_INTEGRATION_GUIDE.md`** - Complete documentation
   - Step-by-step setup guide
   - API usage examples
   - Troubleshooting tips
   - Security best practices

### Updated Files (2 files)

1. **`src/utils/config.ts`** - Added Drift configuration
2. **`env.example`** - Added Drift environment variables

---

## üöÄ Quick Start (3 Commands)

```bash
# 1. Run setup wizard
cd ~/Projects/instinctfi-backend
./scripts/drift-setup.sh

# 2. Test connection
node scripts/test-drift.js

# 3. Start backend
npm run dev
```

---

## üìã What You Need

### Required Right Now:
1. ‚úÖ Solana CLI installed
2. ‚úÖ Node.js 20+ 
3. ‚úÖ Drift SDK (already installed in package.json)

### Needed Before Real Trading:
4. ‚è≥ Trading wallet with SOL for fees
5. ‚è≥ USDC for trading (get test USDC on devnet first!)
6. ‚è≥ Drift user account (script will help create this)

---

## üîß Configuration

The setup script will help you configure these in `.env`:

```bash
# Drift Protocol  
DRIFT_ENVIRONMENT=devnet                     # Start with devnet!
DRIFT_RPC_URL=https://api.devnet.solana.com
DRIFT_TRADING_KEYPAIR=[...]                 # Generated by script
DRIFT_ENABLE_REAL_TRADING=false              # Set to true when ready
DRIFT_DEFAULT_MARKET=SOL-PERP
DRIFT_MAX_LEVERAGE=10
DRIFT_MAX_POSITION_SIZE_USD=10000
```

---

## üéØ Trading Modes

### Mode 1: Mock Trading (DEFAULT - Safe)
```bash
DRIFT_ENABLE_REAL_TRADING=false
```
- ‚úÖ Simulates trades
- ‚úÖ No real money at risk
- ‚úÖ Perfect for development

### Mode 2: Real Trading (When Ready)
```bash
DRIFT_ENABLE_REAL_TRADING=true
DRIFT_ENVIRONMENT=devnet  # Test on devnet first!
```
- üî¥ Executes REAL trades
- üî¥ Requires funded Drift account
- üî¥ Test thoroughly on devnet before mainnet!

---

## üìñ Usage Examples

### In Your Code

```typescript
import { DriftIntegrationService } from '@/services/DriftIntegrationService';

// Initialize
const drift = new DriftIntegrationService();
await drift.initialize();

// Execute trade (mock or real based on config)
const result = await drift.executeTrade({
  marketSymbol: 'SOL-PERP',
  direction: 'long',
  baseAmount: 1.0,
  leverage: 2
});

// Check account
const account = await drift.getAccountInfo();
console.log(`Equity: $${account.equity}`);

// Get positions
const positions = await drift.getOpenPositions();

// Close position
await drift.closePosition('SOL-PERP');
```

---

## ‚ö° Next Steps

### 1. Setup (5 minutes)
```bash
./scripts/drift-setup.sh
```
Choose:
- Devnet (recommended)
- Generate new keypair
- Mock trading mode

### 2. Test (2 minutes)
```bash
node scripts/test-drift.js
```
This verifies everything works.

### 3. Optional: Get Test USDC

On devnet:
- Visit: https://app.drift.trade/?cluster=devnet
- Connect your wallet
- Use faucet to get test USDC
- Deposit to Drift

### 4. Start Testing (Development)

```bash
# Start in mock mode
DRIFT_ENABLE_REAL_TRADING=false npm run dev
```

Create runs and test - trades will be simulated.

### 5. Test Real Trading (When Ready)

```bash
# On devnet with real Drift integration
DRIFT_ENABLE_REAL_TRADING=true DRIFT_ENVIRONMENT=devnet npm run dev
```

Start with small amounts!

---

## üîê Security Checklist

Before enabling real trading:

- [ ] Generated separate keypair for trading
- [ ] Testing on devnet first
- [ ] Small test amounts only
- [ ] Set reasonable limits (`DRIFT_MAX_LEVERAGE`, `DRIFT_MAX_POSITION_SIZE_USD`)
- [ ] Monitoring enabled
- [ ] Emergency shutdown procedure documented
- [ ] Never commit `.env` or keypair files to git

---

## üêõ Troubleshooting

### Issue: "DRIFT_TRADING_KEYPAIR is required"
**Solution:** Run `./scripts/drift-setup.sh`

### Issue: "Drift user account not found"
**Solution:** Run `node scripts/test-drift.js` and let it initialize

### Issue: "Insufficient collateral"
**Solution:** Deposit USDC to your Drift account via https://app.drift.trade/

### Issue: Connection errors
**Solution:** Check RPC URL and network status

---

## üìö Documentation

- **Complete Guide:** `DRIFT_INTEGRATION_GUIDE.md`
- **Integration Status:** `DRIFT_INTEGRATION_STATUS.md`
- **Drift Docs:** https://docs.drift.trade/
- **Drift SDK:** https://github.com/drift-labs/protocol-v2

---

## üí° Key Points

‚úÖ **You have real Drift integration** - not just mocks  
‚úÖ **Safe by default** - starts in mock mode  
‚úÖ **Easy to test** - devnet support built-in  
‚úÖ **Production ready** - when you're ready to switch  
‚úÖ **Well documented** - comprehensive guides included  

---

## üéØ Current Status

| Component | Status | Notes |
|-----------|--------|-------|
| Drift SDK | ‚úÖ Installed | v2.144.0-beta.1 |
| RealDriftService | ‚úÖ Created | Full Drift integration |
| DriftIntegrationService | ‚úÖ Created | Mock/Real switcher |
| Configuration | ‚úÖ Ready | Just run setup script |
| Setup Script | ‚úÖ Created | `./scripts/drift-setup.sh` |
| Test Script | ‚úÖ Created | `node scripts/test-drift.js` |
| Documentation | ‚úÖ Complete | Multiple guides |

**Ready to use!** Run the setup script to get started.

---

## ‚ö†Ô∏è Important Notes

1. **Start with devnet** - Never test on mainnet first
2. **Use mock mode** initially - Switch to real when comfortable
3. **Small amounts** - Start tiny when testing real trading
4. **Monitor closely** - Watch logs and Drift account
5. **Have a plan** - Emergency shutdown procedure ready

---

## üö¶ Recommended Path

1. **Week 1:** Mock trading mode, develop features
2. **Week 2:** Real trading on devnet with test USDC
3. **Week 3:** Increase devnet amounts, stress test
4. **Week 4:** Mainnet with small real amounts
5. **Week 5+:** Gradually scale up

---

## üÜò Need Help?

1. Read `DRIFT_INTEGRATION_GUIDE.md`
2. Run `node scripts/test-drift.js`
3. Check logs: `tail -f logs/combined.log`
4. Visit Drift Discord: https://discord.gg/driftprotocol

---

**You're all set!** Run `./scripts/drift-setup.sh` to begin. üöÄ

